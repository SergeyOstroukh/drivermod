# Настройка лога пробега и расхода топлива

## Выполнение миграций

Выполните следующие миграции в Supabase SQL Editor в указанном порядке:

1. **007_add_fuel_consumption.sql** - Добавляет поле расхода топлива в таблицу vehicles
2. **008_create_vehicle_mileage_log.sql** - Создает таблицу для записи ежедневных показаний пробега

## Что делает каждая миграция

### 007_add_fuel_consumption.sql
- Добавляет поле `fuel_consumption` (DECIMAL(5,2)) в таблицу `vehicles`
- Это расход топлива в литрах на 100 км

### 008_create_vehicle_mileage_log.sql
- Создает таблицу `vehicle_mileage_log` для записи ежедневных показаний пробега
- Автоматически обновляет пробег в таблице `vehicles` при добавлении новой записи
- Поля таблицы:
  - `id` - уникальный идентификатор
  - `vehicle_id` - ссылка на автомобиль
  - `driver_id` - ссылка на водителя
  - `mileage` - общий пробег на момент записи
  - `log_date` - дата записи
  - `notes` - примечания
  - `created_at`, `updated_at` - временные метки

## Использование

После выполнения миграций:

1. **Добавьте расход топлива** для каждого автомобиля в форме редактирования
2. **Вводите пробег** после каждой рабочей смены через кнопку "Ввести пробег" на карточке автомобиля
3. **Просматривайте историю** в таблице лога пробега с автоматическим расчетом:
   - Пробега за смену (разница с предыдущей записью)
   - Расхода топлива (пробег за смену × расход / 100)
4. **Фильтруйте по месяцу** для просмотра данных за конкретный период
5. **Печатайте таблицу** кнопкой "Печать" для отчетности

## Автоматическое обновление пробега

При добавлении записи в лог пробега автоматически обновляется общий пробег в карточке автомобиля (берется максимальное значение из логов).

