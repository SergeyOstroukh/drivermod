# Настройка таблиц водителей и автомобилей

## Выполнение миграций

### Шаг 1: Откройте SQL Editor в Supabase

1. Перейдите на https://supabase.com/dashboard
2. Выберите ваш проект
3. В левом меню нажмите **SQL Editor**
4. Нажмите **New query**

### Шаг 2: Выполните миграцию

Скопируйте весь код из файла `supabase/migrations/COMPLETE_VEHICLES_SETUP.sql` и выполните его.

Или выполните миграции по отдельности:
1. Сначала `003_create_drivers_table.sql` (таблица водителей)
2. Затем `004_create_vehicles_table.sql` (таблица автомобилей)

### Шаг 3: Проверьте создание таблиц

1. В левом меню нажмите **Table Editor**
2. Должны появиться две новые таблицы:
   - `drivers` (водители)
   - `vehicles` (автомобили)

## Структура таблиц

### Таблица `drivers` (водители):
- `id` - уникальный идентификатор
- `name` - ФИО водителя
- `phone` - телефон
- `license_number` - номер водительского удостоверения
- `license_expiry` - срок действия удостоверения
- `notes` - примечания
- `created_at`, `updated_at` - даты создания/обновления

### Таблица `vehicles` (автомобили):
- `id` - уникальный идентификатор
- `plate_number` - гос. номер (обязательно)
- `driver_id` - ссылка на водителя (может быть NULL)
- `mileage` - пробег в км
- `oil_change_info` - информация по замене масла
- `oil_change_interval` - регламент замены масла (км)
- `inspection_expiry` - срок действия техосмотра
- `insurance_expiry` - срок действия страховки
- `driver_period_start` - начало периода использования водителем
- `driver_period_end` - конец периода использования водителем
- `notes` - примечания
- `created_at`, `updated_at` - даты создания/обновления

## Использование

После выполнения миграций:

1. Откройте `index.html` в браузере
2. Переключитесь на вкладку **Водители** или **Автомобили**
3. Нажмите **Добавить** для создания новой записи

### Возможности:

**Водители:**
- Добавление, редактирование, удаление водителей
- Указание телефона, номера удостоверения
- Отслеживание срока действия удостоверения (предупреждение за 30 дней)

**Автомобили:**
- Добавление, редактирование, удаление автомобилей
- Назначение водителя на автомобиль
- Отслеживание пробега
- Информация по замене масла и регламент
- Отслеживание сроков техосмотра и страховки (предупреждения за 30 дней)
- Указание периода использования водителем (для временного назначения)

## Решение проблем

### Ошибка "relation does not exist"
- Убедитесь, что выполнили миграции
- Проверьте, что таблицы созданы в Table Editor

### Ошибка "foreign key constraint"
- Убедитесь, что сначала создана таблица `drivers`
- Проверьте, что внешний ключ настроен правильно

### Не отображаются водители в списке при добавлении автомобиля
- Убедитесь, что добавлены водители в разделе "Водители"
- Проверьте консоль браузера (F12) на наличие ошибок

